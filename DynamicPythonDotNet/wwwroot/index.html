<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>DynamicPythonDotNet</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="_content/Radzen.Blazor/css/default.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="DynamicPythonDotNet.styles.css" />
    <link rel="icon" href="data:,">
</head>

<script src="https://cdn.jsdelivr.net/pyodide/v0.27.1/full/pyodide.js"></script>

<script>
    let pyodideReadyPromise = loadPyodide();

    async function runPythonScript(pythonCode) {
    let pyodide = await pyodideReadyPromise;

    // Load the Pandas package
    await pyodide.loadPackage("pandas");

    // Import necessary modules
    pyodide.runPython(`import json`);

    try {
        // Execute the Python code
        pyodide.runPython(pythonCode + `
_result = load_data()
if not isinstance(_result, pd.DataFrame):
    raise TypeError("Must return a DataFrame")
_result_json = _result.to_json(orient="records")
`);

        // Retrieve the JSON result
        const resultJson = pyodide.globals.get('_result_json');
        return resultJson;
    } catch (error) {
        // Extract and throw only the relevant error message
        const errorMessage = error.message.split("\n").find(line => line.includes("TypeError: Must return a DataFrame"));
        throw new Error(errorMessage || "An error occurred while executing the Python code.");
    }
}
</script>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>

</body>

</html>